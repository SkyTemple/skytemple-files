#  Copyright 2020-2022 Capypara and the SkyTemple Contributors
#
#  This file is part of SkyTemple.
#
#  SkyTemple is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation, either version 3 of the License, or
#  (at your option) any later version.
#
#  SkyTemple is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with SkyTemple.  If not, see <https://www.gnu.org/licenses/>.
from __future__ import annotations

import typing

from range_typed_integers import u16

from skytemple_files.graphics.bpl.handler import BplHandler
from skytemple_files.graphics.bpl.protocol import BplAnimationSpecProtocol, BplProtocol
from skytemple_files_test.graphics.mocks.bpl_mock import SIMPLE_DUMMY_PALETTE
from skytemple_files_test.case import SkyTempleFilesTestCase, fixpath, romtest


class BplTestCase(SkyTempleFilesTestCase[BplHandler, BplProtocol[BplAnimationSpecProtocol]]):
    handler = BplHandler

    def setUp(self) -> None:
        self.one = self._load_main_fixture(self._fix_path1())
        self.assertIsNotNone(self.one)
        self.two = self._load_main_fixture(self._fix_path2())
        self.assertIsNotNone(self.two)

    def test_metadata(self) -> None:
        self.assertEqual(16, self.one.number_palettes)
        self.assertEqual(True, self.one.has_palette_animation)
        self.assertEqual(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    165,
                    148,
                    132,
                    74,
                    66,
                    49,
                    189,
                    165,
                    148,
                    58,
                    49,
                    41,
                    115,
                    99,
                    82,
                    214,
                    189,
                    173,
                    132,
                    107,
                    74,
                    41,
                    33,
                    25,
                    148,
                    132,
                    115,
                    197,
                    156,
                    132,
                    132,
                    115,
                    99,
                    247,
                    230,
                    206,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    90,
                    74,
                    66,
                    107,
                    90,
                    74,
                    74,
                    58,
                    49,
                    99,
                    82,
                    74,
                    148,
                    132,
                    115,
                    123,
                    107,
                    90,
                    206,
                    181,
                    165,
                    107,
                    90,
                    82,
                    99,
                    74,
                    49,
                    82,
                    66,
                    58,
                    115,
                    82,
                    58,
                    58,
                    49,
                    33,
                    123,
                    90,
                    66,
                    132,
                    99,
                    74,
                    115,
                    99,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    173,
                    148,
                    132,
                    156,
                    132,
                    115,
                    189,
                    173,
                    156,
                    181,
                    140,
                    107,
                    99,
                    82,
                    66,
                    222,
                    197,
                    181,
                    66,
                    58,
                    49,
                    140,
                    99,
                    74,
                    181,
                    156,
                    140,
                    148,
                    132,
                    115,
                    165,
                    140,
                    123,
                    123,
                    107,
                    90,
                    148,
                    132,
                    123,
                    148,
                    115,
                    90,
                    165,
                    148,
                    132,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    49,
                    41,
                    99,
                    82,
                    74,
                    82,
                    58,
                    41,
                    74,
                    66,
                    58,
                    74,
                    49,
                    33,
                    66,
                    58,
                    49,
                    90,
                    66,
                    49,
                    49,
                    41,
                    33,
                    132,
                    115,
                    107,
                    107,
                    82,
                    58,
                    82,
                    66,
                    49,
                    99,
                    74,
                    58,
                    115,
                    99,
                    82,
                    82,
                    74,
                    66,
                    58,
                    41,
                    25,
                ],
                [
                    0,
                    0,
                    0,
                    189,
                    165,
                    148,
                    132,
                    107,
                    90,
                    197,
                    173,
                    156,
                    222,
                    206,
                    181,
                    173,
                    156,
                    132,
                    99,
                    82,
                    66,
                    156,
                    132,
                    115,
                    74,
                    58,
                    49,
                    189,
                    148,
                    115,
                    206,
                    181,
                    165,
                    197,
                    173,
                    148,
                    214,
                    189,
                    156,
                    189,
                    173,
                    148,
                    214,
                    181,
                    148,
                    197,
                    181,
                    165,
                ],
                [
                    0,
                    0,
                    0,
                    49,
                    41,
                    33,
                    66,
                    58,
                    49,
                    41,
                    33,
                    33,
                    58,
                    49,
                    41,
                    107,
                    90,
                    82,
                    132,
                    115,
                    107,
                    66,
                    49,
                    41,
                    90,
                    74,
                    66,
                    82,
                    66,
                    49,
                    74,
                    66,
                    58,
                    58,
                    58,
                    49,
                    74,
                    58,
                    41,
                    99,
                    74,
                    58,
                    82,
                    74,
                    66,
                    90,
                    82,
                    66,
                ],
                [
                    0,
                    0,
                    0,
                    99,
                    82,
                    74,
                    115,
                    99,
                    82,
                    189,
                    173,
                    148,
                    132,
                    115,
                    99,
                    82,
                    66,
                    58,
                    140,
                    123,
                    107,
                    58,
                    49,
                    41,
                    123,
                    107,
                    90,
                    123,
                    99,
                    74,
                    107,
                    82,
                    58,
                    90,
                    74,
                    66,
                    156,
                    140,
                    115,
                    99,
                    82,
                    66,
                    140,
                    107,
                    82,
                    214,
                    189,
                    173,
                ],
                [
                    0,
                    0,
                    0,
                    214,
                    189,
                    173,
                    90,
                    74,
                    66,
                    222,
                    197,
                    173,
                    197,
                    173,
                    148,
                    255,
                    230,
                    206,
                    189,
                    148,
                    115,
                    206,
                    165,
                    132,
                    173,
                    156,
                    140,
                    214,
                    189,
                    156,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    148,
                    132,
                    115,
                    214,
                    181,
                    148,
                    206,
                    181,
                    165,
                    214,
                    197,
                    181,
                ],
                [
                    0,
                    0,
                    0,
                    148,
                    115,
                    82,
                    115,
                    82,
                    58,
                    165,
                    123,
                    99,
                    140,
                    99,
                    74,
                    99,
                    74,
                    49,
                    123,
                    90,
                    66,
                    173,
                    140,
                    123,
                    115,
                    82,
                    66,
                    132,
                    107,
                    82,
                    132,
                    99,
                    66,
                    140,
                    115,
                    90,
                    82,
                    58,
                    41,
                    123,
                    99,
                    82,
                    132,
                    90,
                    66,
                    123,
                    107,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    33,
                    25,
                    25,
                    49,
                    41,
                    41,
                    25,
                    25,
                    16,
                    66,
                    58,
                    49,
                    41,
                    33,
                    25,
                    58,
                    49,
                    41,
                    41,
                    41,
                    33,
                    33,
                    33,
                    25,
                    41,
                    33,
                    33,
                    49,
                    41,
                    33,
                    82,
                    74,
                    66,
                    58,
                    58,
                    49,
                    74,
                    58,
                    41,
                    66,
                    49,
                    41,
                    25,
                    16,
                    16,
                ],
                [
                    0,
                    0,
                    0,
                    156,
                    132,
                    115,
                    132,
                    115,
                    99,
                    165,
                    140,
                    123,
                    82,
                    66,
                    58,
                    148,
                    115,
                    82,
                    214,
                    189,
                    173,
                    181,
                    140,
                    107,
                    165,
                    123,
                    90,
                    148,
                    123,
                    107,
                    140,
                    123,
                    115,
                    132,
                    107,
                    90,
                    123,
                    90,
                    74,
                    132,
                    115,
                    107,
                    189,
                    156,
                    123,
                    181,
                    165,
                    148,
                ],
                [
                    0,
                    0,
                    0,
                    197,
                    156,
                    123,
                    181,
                    140,
                    107,
                    214,
                    181,
                    148,
                    230,
                    206,
                    181,
                    173,
                    156,
                    132,
                    206,
                    165,
                    132,
                    197,
                    173,
                    148,
                    247,
                    222,
                    197,
                    148,
                    123,
                    107,
                    123,
                    99,
                    74,
                    181,
                    165,
                    140,
                    214,
                    189,
                    156,
                    222,
                    197,
                    181,
                    173,
                    148,
                    132,
                    181,
                    156,
                    140,
                ],
                [
                    0,
                    0,
                    0,
                    132,
                    107,
                    90,
                    140,
                    123,
                    107,
                    222,
                    197,
                    173,
                    148,
                    132,
                    115,
                    90,
                    74,
                    66,
                    140,
                    123,
                    99,
                    132,
                    115,
                    107,
                    132,
                    115,
                    99,
                    115,
                    99,
                    82,
                    123,
                    107,
                    99,
                    189,
                    148,
                    123,
                    140,
                    115,
                    90,
                    115,
                    99,
                    90,
                    173,
                    156,
                    140,
                    156,
                    123,
                    99,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    239,
                    214,
                    222,
                    206,
                    189,
                    247,
                    222,
                    197,
                    197,
                    173,
                    156,
                    214,
                    197,
                    181,
                    197,
                    181,
                    165,
                    206,
                    189,
                    173,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    255,
                    239,
                    214,
                    189,
                    165,
                    148,
                    222,
                    197,
                    173,
                    255,
                    239,
                    214,
                    255,
                    239,
                    214,
                    247,
                    222,
                    197,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    107,
                    123,
                    148,
                    255,
                    115,
                    123,
                    140,
                    255,
                    90,
                    107,
                    132,
                    255,
                    74,
                    90,
                    123,
                    255,
                    107,
                    115,
                    132,
                    255,
                    123,
                    156,
                    189,
                    255,
                    148,
                    165,
                    181,
                    255,
                    0,
                    0,
                    0,
                    0,
                    123,
                    156,
                    197,
                    255,
                    107,
                    140,
                    181,
                    255,
                    148,
                    181,
                    214,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    132,
                    156,
                    173,
                    255,
                    132,
                    165,
                    206,
                    255,
                    148,
                    173,
                    197,
                    255,
                    197,
                    222,
                    247,
                    255,
                    107,
                    123,
                    148,
                    255,
                    74,
                    99,
                    123,
                    255,
                    140,
                    165,
                    181,
                    255,
                    156,
                    189,
                    214,
                    255,
                    181,
                    197,
                    222,
                    255,
                    132,
                    148,
                    173,
                    255,
                    140,
                    156,
                    181,
                    255,
                ],
            ],
            self.one.palettes,
        )
        self.assertEqual(
            [
                [
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                ],
                [
                    36,
                    128,
                    166,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                ],
                [
                    33,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                ],
                [
                    19,
                    33,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                ],
            ],
            self.one.animation_palette,
        )

        self.assertEqual(16, self.two.number_palettes)
        self.assertEqual(False, self.two.has_palette_animation)
        self.assertEqual(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    132,
                    206,
                    0,
                    99,
                    181,
                    0,
                    107,
                    189,
                    49,
                    162,
                    221,
                    8,
                    107,
                    181,
                    16,
                    99,
                    189,
                    8,
                    99,
                    173,
                    33,
                    107,
                    197,
                    16,
                    99,
                    173,
                    47,
                    157,
                    224,
                    0,
                    107,
                    197,
                    0,
                    115,
                    197,
                    0,
                    123,
                    206,
                    0,
                    140,
                    214,
                    25,
                    90,
                    165,
                ],
                [
                    0,
                    0,
                    0,
                    25,
                    90,
                    165,
                    33,
                    90,
                    140,
                    41,
                    82,
                    140,
                    41,
                    90,
                    140,
                    33,
                    82,
                    140,
                    33,
                    90,
                    148,
                    25,
                    90,
                    156,
                    41,
                    90,
                    140,
                    41,
                    90,
                    140,
                    33,
                    90,
                    148,
                    41,
                    90,
                    140,
                    33,
                    82,
                    140,
                    33,
                    90,
                    148,
                    16,
                    90,
                    156,
                    33,
                    90,
                    148,
                ],
                [
                    0,
                    0,
                    0,
                    41,
                    90,
                    140,
                    58,
                    99,
                    140,
                    58,
                    99,
                    140,
                    58,
                    99,
                    140,
                    58,
                    99,
                    140,
                    58,
                    99,
                    140,
                    66,
                    107,
                    132,
                    49,
                    90,
                    140,
                    58,
                    99,
                    140,
                    58,
                    99,
                    140,
                    58,
                    99,
                    140,
                    58,
                    99,
                    140,
                    58,
                    99,
                    140,
                    58,
                    99,
                    140,
                    58,
                    90,
                    140,
                ],
                [
                    0,
                    0,
                    0,
                    58,
                    26,
                    42,
                    178,
                    146,
                    153,
                    128,
                    136,
                    149,
                    102,
                    90,
                    100,
                    85,
                    77,
                    89,
                    140,
                    148,
                    164,
                    66,
                    49,
                    63,
                    151,
                    117,
                    123,
                    193,
                    148,
                    148,
                    166,
                    173,
                    187,
                    148,
                    147,
                    159,
                    192,
                    143,
                    151,
                    206,
                    156,
                    156,
                    124,
                    104,
                    110,
                    149,
                    158,
                    173,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                    58,
                    99,
                    140,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                    66,
                    99,
                    132,
                ],
                [
                    0,
                    0,
                    0,
                    98,
                    164,
                    255,
                    156,
                    197,
                    230,
                    197,
                    230,
                    255,
                    174,
                    215,
                    240,
                    136,
                    214,
                    255,
                    222,
                    239,
                    255,
                    123,
                    206,
                    255,
                    148,
                    230,
                    255,
                    206,
                    239,
                    255,
                    115,
                    189,
                    255,
                    132,
                    206,
                    255,
                    239,
                    247,
                    255,
                    140,
                    222,
                    255,
                    107,
                    181,
                    255,
                    123,
                    197,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    107,
                    140,
                    66,
                    107,
                    132,
                    82,
                    107,
                    132,
                    74,
                    107,
                    140,
                    82,
                    82,
                    99,
                    74,
                    107,
                    132,
                    82,
                    99,
                    123,
                    82,
                    74,
                    90,
                    82,
                    115,
                    132,
                    90,
                    82,
                    99,
                    82,
                    107,
                    123,
                    82,
                    74,
                    82,
                    82,
                    90,
                    111,
                    90,
                    90,
                    107,
                    90,
                    82,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    58,
                    28,
                    44,
                    111,
                    115,
                    128,
                    156,
                    165,
                    181,
                    132,
                    140,
                    156,
                    155,
                    168,
                    176,
                    76,
                    68,
                    80,
                    140,
                    148,
                    164,
                    191,
                    146,
                    149,
                    169,
                    144,
                    149,
                    167,
                    175,
                    192,
                    148,
                    156,
                    173,
                    140,
                    156,
                    164,
                    92,
                    88,
                    100,
                    63,
                    45,
                    59,
                    124,
                    139,
                    147,
                ],
                [
                    0,
                    0,
                    0,
                    58,
                    28,
                    44,
                    74,
                    107,
                    140,
                    66,
                    50,
                    62,
                    135,
                    142,
                    155,
                    82,
                    74,
                    82,
                    82,
                    115,
                    132,
                    82,
                    75,
                    92,
                    84,
                    105,
                    121,
                    90,
                    82,
                    90,
                    91,
                    102,
                    110,
                    151,
                    161,
                    175,
                    92,
                    79,
                    97,
                    96,
                    91,
                    101,
                    87,
                    93,
                    109,
                    111,
                    116,
                    126,
                ],
                [
                    0,
                    0,
                    0,
                    30,
                    189,
                    229,
                    8,
                    156,
                    230,
                    10,
                    102,
                    181,
                    55,
                    159,
                    225,
                    0,
                    140,
                    214,
                    58,
                    167,
                    221,
                    2,
                    165,
                    222,
                    0,
                    132,
                    206,
                    0,
                    107,
                    197,
                    49,
                    123,
                    206,
                    0,
                    123,
                    206,
                    3,
                    176,
                    225,
                    54,
                    157,
                    226,
                    97,
                    186,
                    241,
                    33,
                    107,
                    197,
                ],
                [
                    0,
                    0,
                    0,
                    74,
                    107,
                    140,
                    82,
                    82,
                    96,
                    74,
                    107,
                    132,
                    74,
                    107,
                    132,
                    82,
                    74,
                    82,
                    83,
                    104,
                    130,
                    90,
                    82,
                    90,
                    82,
                    107,
                    140,
                    82,
                    74,
                    90,
                    90,
                    90,
                    107,
                    82,
                    115,
                    132,
                    90,
                    82,
                    99,
                    83,
                    91,
                    108,
                    83,
                    106,
                    122,
                    90,
                    74,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    58,
                    30,
                    46,
                    63,
                    42,
                    55,
                    70,
                    61,
                    72,
                    102,
                    109,
                    123,
                    91,
                    82,
                    90,
                    142,
                    151,
                    163,
                    186,
                    141,
                    145,
                    81,
                    113,
                    131,
                    92,
                    88,
                    100,
                    82,
                    74,
                    90,
                    82,
                    74,
                    82,
                    100,
                    91,
                    98,
                    58,
                    33,
                    41,
                    85,
                    88,
                    104,
                    93,
                    76,
                    92,
                ],
                [
                    0,
                    0,
                    0,
                    10,
                    112,
                    175,
                    90,
                    156,
                    255,
                    41,
                    156,
                    222,
                    107,
                    173,
                    255,
                    123,
                    201,
                    252,
                    114,
                    181,
                    255,
                    172,
                    219,
                    251,
                    99,
                    165,
                    255,
                    0,
                    127,
                    207,
                    0,
                    107,
                    197,
                    114,
                    194,
                    253,
                    214,
                    242,
                    255,
                    8,
                    103,
                    176,
                    66,
                    156,
                    230,
                    112,
                    189,
                    253,
                ],
                [
                    0,
                    0,
                    0,
                    64,
                    230,
                    249,
                    0,
                    169,
                    222,
                    140,
                    239,
                    247,
                    39,
                    195,
                    229,
                    0,
                    230,
                    239,
                    230,
                    255,
                    255,
                    58,
                    214,
                    247,
                    16,
                    197,
                    230,
                    64,
                    239,
                    232,
                    64,
                    230,
                    250,
                    64,
                    236,
                    237,
                    8,
                    181,
                    230,
                    49,
                    214,
                    239,
                    64,
                    244,
                    221,
                    64,
                    232,
                    246,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
            ],
            self.two.palettes,
        )
        self.assertEqual([], self.two.animation_palette)

        self.one.number_palettes = u16(len(SIMPLE_DUMMY_PALETTE) * 2)
        self.one.has_palette_animation = False
        self.one.palettes = list(SIMPLE_DUMMY_PALETTE + SIMPLE_DUMMY_PALETTE)
        self.one.animation_palette = []
        saved = self._save_and_reload_main_fixture(self.one)
        self.assertEqual(len(SIMPLE_DUMMY_PALETTE) * 2, saved.number_palettes)
        self.assertEqual(False, saved.has_palette_animation)
        self.assertEqual(SIMPLE_DUMMY_PALETTE + SIMPLE_DUMMY_PALETTE, saved.palettes)
        self.assertEqual([], saved.animation_palette)

        self.two.number_palettes = u16(len(SIMPLE_DUMMY_PALETTE))
        self.two.has_palette_animation = True
        self.two.palettes = list(SIMPLE_DUMMY_PALETTE)
        self.two.animation_palette = [[3] * 45] + [[2] * 45] + [[1] * 45]
        self.two.animation_specs = [self.handler.get_animation_spec_model_cls()(u16(0), u16(0))] * len(
            SIMPLE_DUMMY_PALETTE
        )
        saved = self._save_and_reload_main_fixture(self.two)
        self.assertEqual(len(SIMPLE_DUMMY_PALETTE), saved.number_palettes)
        self.assertEqual(True, saved.has_palette_animation)
        self.assertEqual(SIMPLE_DUMMY_PALETTE, saved.palettes)
        self.assertEqual([[3] * 45] + [[2] * 45] + [[1] * 45], saved.animation_palette)

    def test_animation_specs(self) -> None:
        self.assertEqual(16, len(self.one.animation_specs))
        self.assertEqual(0, len(self.two.animation_specs))

        self.assertEqual(0, self.one.animation_specs[0].number_of_frames)
        self.assertEqual(0, self.one.animation_specs[0].duration_per_frame)
        self.assertEqual(4, self.one.animation_specs[9].number_of_frames)
        self.assertEqual(20, self.one.animation_specs[9].duration_per_frame)

        self.one.animation_specs[0].number_of_frames = u16(1)
        self.one.animation_specs[0].duration_per_frame = u16(2)
        self.one.animation_specs[9].number_of_frames = u16(3)
        self.one.animation_specs[9].duration_per_frame = u16(4)

        saved = self._save_and_reload_main_fixture(self.one)

        self.assertEqual(1, saved.animation_specs[0].number_of_frames)
        self.assertEqual(2, saved.animation_specs[0].duration_per_frame)
        self.assertEqual(3, saved.animation_specs[9].number_of_frames)
        self.assertEqual(4, saved.animation_specs[9].duration_per_frame)

    def test_import_palettes(self) -> None:
        new_pal = [
            [0] * 16 * 3,
            [0, 0, 0] + [1] * 15 * 3,
            [0, 0, 0] + [2] * 15 * 3,
            [0, 0, 0] + [3] * 15 * 3,
        ]
        greyscale = [(i // 3) * 16 for i in range(16 * 3)]
        self.one.import_palettes(new_pal * 4)

        self.assertEqual(16, self.one.number_palettes)
        self.assertEqual(new_pal * 4, self.one.palettes)
        self.assertEqual(16, len(self.one.animation_specs))
        saved = self._save_and_reload_main_fixture(self.one)
        self.assertEqual(16, saved.number_palettes)
        self.assertEqual(new_pal * 4, saved.palettes)
        self.assertEqual(16, len(saved.animation_specs))

        self.one.import_palettes(list(new_pal))

        self.assertEqual(4, self.one.number_palettes)
        self.assertEqual(new_pal, self.one.palettes)
        self.assertEqual(4, len(self.one.animation_specs))
        saved = self._save_and_reload_main_fixture(self.one)
        self.assertEqual(4, saved.number_palettes)
        self.assertEqual(new_pal + [greyscale] * 12, saved.palettes)
        self.assertEqual(4, len(saved.animation_specs))

        with self.assertRaises(AssertionError):
            self.one.import_palettes(new_pal * 8)

    def test_apply_palette_animations(self) -> None:
        for i in range(16):
            self.assertEqual([], self.two.apply_palette_animations(i))

        self.assertEqual(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    165,
                    148,
                    132,
                    74,
                    66,
                    49,
                    189,
                    165,
                    148,
                    58,
                    49,
                    41,
                    115,
                    99,
                    82,
                    214,
                    189,
                    173,
                    132,
                    107,
                    74,
                    41,
                    33,
                    25,
                    148,
                    132,
                    115,
                    197,
                    156,
                    132,
                    132,
                    115,
                    99,
                    247,
                    230,
                    206,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    90,
                    74,
                    66,
                    107,
                    90,
                    74,
                    74,
                    58,
                    49,
                    99,
                    82,
                    74,
                    148,
                    132,
                    115,
                    123,
                    107,
                    90,
                    206,
                    181,
                    165,
                    107,
                    90,
                    82,
                    99,
                    74,
                    49,
                    82,
                    66,
                    58,
                    115,
                    82,
                    58,
                    58,
                    49,
                    33,
                    123,
                    90,
                    66,
                    132,
                    99,
                    74,
                    115,
                    99,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    173,
                    148,
                    132,
                    156,
                    132,
                    115,
                    189,
                    173,
                    156,
                    181,
                    140,
                    107,
                    99,
                    82,
                    66,
                    222,
                    197,
                    181,
                    66,
                    58,
                    49,
                    140,
                    99,
                    74,
                    181,
                    156,
                    140,
                    148,
                    132,
                    115,
                    165,
                    140,
                    123,
                    123,
                    107,
                    90,
                    148,
                    132,
                    123,
                    148,
                    115,
                    90,
                    165,
                    148,
                    132,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    49,
                    41,
                    99,
                    82,
                    74,
                    82,
                    58,
                    41,
                    74,
                    66,
                    58,
                    74,
                    49,
                    33,
                    66,
                    58,
                    49,
                    90,
                    66,
                    49,
                    49,
                    41,
                    33,
                    132,
                    115,
                    107,
                    107,
                    82,
                    58,
                    82,
                    66,
                    49,
                    99,
                    74,
                    58,
                    115,
                    99,
                    82,
                    82,
                    74,
                    66,
                    58,
                    41,
                    25,
                ],
                [
                    0,
                    0,
                    0,
                    189,
                    165,
                    148,
                    132,
                    107,
                    90,
                    197,
                    173,
                    156,
                    222,
                    206,
                    181,
                    173,
                    156,
                    132,
                    99,
                    82,
                    66,
                    156,
                    132,
                    115,
                    74,
                    58,
                    49,
                    189,
                    148,
                    115,
                    206,
                    181,
                    165,
                    197,
                    173,
                    148,
                    214,
                    189,
                    156,
                    189,
                    173,
                    148,
                    214,
                    181,
                    148,
                    197,
                    181,
                    165,
                ],
                [
                    0,
                    0,
                    0,
                    49,
                    41,
                    33,
                    66,
                    58,
                    49,
                    41,
                    33,
                    33,
                    58,
                    49,
                    41,
                    107,
                    90,
                    82,
                    132,
                    115,
                    107,
                    66,
                    49,
                    41,
                    90,
                    74,
                    66,
                    82,
                    66,
                    49,
                    74,
                    66,
                    58,
                    58,
                    58,
                    49,
                    74,
                    58,
                    41,
                    99,
                    74,
                    58,
                    82,
                    74,
                    66,
                    90,
                    82,
                    66,
                ],
                [
                    0,
                    0,
                    0,
                    99,
                    82,
                    74,
                    115,
                    99,
                    82,
                    189,
                    173,
                    148,
                    132,
                    115,
                    99,
                    82,
                    66,
                    58,
                    140,
                    123,
                    107,
                    58,
                    49,
                    41,
                    123,
                    107,
                    90,
                    123,
                    99,
                    74,
                    107,
                    82,
                    58,
                    90,
                    74,
                    66,
                    156,
                    140,
                    115,
                    99,
                    82,
                    66,
                    140,
                    107,
                    82,
                    214,
                    189,
                    173,
                ],
                [
                    0,
                    0,
                    0,
                    214,
                    189,
                    173,
                    90,
                    74,
                    66,
                    222,
                    197,
                    173,
                    197,
                    173,
                    148,
                    255,
                    230,
                    206,
                    189,
                    148,
                    115,
                    206,
                    165,
                    132,
                    173,
                    156,
                    140,
                    214,
                    189,
                    156,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    148,
                    132,
                    115,
                    214,
                    181,
                    148,
                    206,
                    181,
                    165,
                    214,
                    197,
                    181,
                ],
                [
                    0,
                    0,
                    0,
                    148,
                    115,
                    82,
                    115,
                    82,
                    58,
                    165,
                    123,
                    99,
                    140,
                    99,
                    74,
                    99,
                    74,
                    49,
                    123,
                    90,
                    66,
                    173,
                    140,
                    123,
                    115,
                    82,
                    66,
                    132,
                    107,
                    82,
                    132,
                    99,
                    66,
                    140,
                    115,
                    90,
                    82,
                    58,
                    41,
                    123,
                    99,
                    82,
                    132,
                    90,
                    66,
                    123,
                    107,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    156,
                    132,
                    115,
                    132,
                    115,
                    99,
                    165,
                    140,
                    123,
                    82,
                    66,
                    58,
                    148,
                    115,
                    82,
                    214,
                    189,
                    173,
                    181,
                    140,
                    107,
                    165,
                    123,
                    90,
                    148,
                    123,
                    107,
                    140,
                    123,
                    115,
                    132,
                    107,
                    90,
                    123,
                    90,
                    74,
                    132,
                    115,
                    107,
                    189,
                    156,
                    123,
                    181,
                    165,
                    148,
                ],
                [
                    0,
                    0,
                    0,
                    197,
                    156,
                    123,
                    181,
                    140,
                    107,
                    214,
                    181,
                    148,
                    230,
                    206,
                    181,
                    173,
                    156,
                    132,
                    206,
                    165,
                    132,
                    197,
                    173,
                    148,
                    247,
                    222,
                    197,
                    148,
                    123,
                    107,
                    123,
                    99,
                    74,
                    181,
                    165,
                    140,
                    214,
                    189,
                    156,
                    222,
                    197,
                    181,
                    173,
                    148,
                    132,
                    181,
                    156,
                    140,
                ],
                [
                    0,
                    0,
                    0,
                    132,
                    107,
                    90,
                    140,
                    123,
                    107,
                    222,
                    197,
                    173,
                    148,
                    132,
                    115,
                    90,
                    74,
                    66,
                    140,
                    123,
                    99,
                    132,
                    115,
                    107,
                    132,
                    115,
                    99,
                    115,
                    99,
                    82,
                    123,
                    107,
                    99,
                    189,
                    148,
                    123,
                    140,
                    115,
                    90,
                    115,
                    99,
                    90,
                    173,
                    156,
                    140,
                    156,
                    123,
                    99,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    239,
                    214,
                    222,
                    206,
                    189,
                    247,
                    222,
                    197,
                    197,
                    173,
                    156,
                    214,
                    197,
                    181,
                    197,
                    181,
                    165,
                    206,
                    189,
                    173,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    255,
                    239,
                    214,
                    189,
                    165,
                    148,
                    222,
                    197,
                    173,
                    255,
                    239,
                    214,
                    255,
                    239,
                    214,
                    247,
                    222,
                    197,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    107,
                    123,
                    148,
                    255,
                    115,
                    123,
                    140,
                    255,
                    90,
                    107,
                    132,
                    255,
                    74,
                    90,
                    123,
                    255,
                    107,
                    115,
                    132,
                    255,
                    123,
                    156,
                    189,
                    255,
                    148,
                    165,
                    181,
                    255,
                    0,
                    0,
                    0,
                    0,
                    123,
                    156,
                    197,
                    255,
                    107,
                    140,
                    181,
                    255,
                    148,
                    181,
                    214,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    132,
                    156,
                    173,
                    255,
                    132,
                    165,
                    206,
                    255,
                    148,
                    173,
                    197,
                    255,
                    197,
                    222,
                    247,
                    255,
                    107,
                    123,
                    148,
                    255,
                    74,
                    99,
                    123,
                    255,
                    140,
                    165,
                    181,
                    255,
                    156,
                    189,
                    214,
                    255,
                    181,
                    197,
                    222,
                    255,
                    132,
                    148,
                    173,
                    255,
                    140,
                    156,
                    181,
                    255,
                ],
            ],
            self.one.apply_palette_animations(0),
        )
        self.assertEqual(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    165,
                    148,
                    132,
                    74,
                    66,
                    49,
                    189,
                    165,
                    148,
                    58,
                    49,
                    41,
                    115,
                    99,
                    82,
                    214,
                    189,
                    173,
                    132,
                    107,
                    74,
                    41,
                    33,
                    25,
                    148,
                    132,
                    115,
                    197,
                    156,
                    132,
                    132,
                    115,
                    99,
                    247,
                    230,
                    206,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    90,
                    74,
                    66,
                    107,
                    90,
                    74,
                    74,
                    58,
                    49,
                    99,
                    82,
                    74,
                    148,
                    132,
                    115,
                    123,
                    107,
                    90,
                    206,
                    181,
                    165,
                    107,
                    90,
                    82,
                    99,
                    74,
                    49,
                    82,
                    66,
                    58,
                    115,
                    82,
                    58,
                    58,
                    49,
                    33,
                    123,
                    90,
                    66,
                    132,
                    99,
                    74,
                    115,
                    99,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    173,
                    148,
                    132,
                    156,
                    132,
                    115,
                    189,
                    173,
                    156,
                    181,
                    140,
                    107,
                    99,
                    82,
                    66,
                    222,
                    197,
                    181,
                    66,
                    58,
                    49,
                    140,
                    99,
                    74,
                    181,
                    156,
                    140,
                    148,
                    132,
                    115,
                    165,
                    140,
                    123,
                    123,
                    107,
                    90,
                    148,
                    132,
                    123,
                    148,
                    115,
                    90,
                    165,
                    148,
                    132,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    49,
                    41,
                    99,
                    82,
                    74,
                    82,
                    58,
                    41,
                    74,
                    66,
                    58,
                    74,
                    49,
                    33,
                    66,
                    58,
                    49,
                    90,
                    66,
                    49,
                    49,
                    41,
                    33,
                    132,
                    115,
                    107,
                    107,
                    82,
                    58,
                    82,
                    66,
                    49,
                    99,
                    74,
                    58,
                    115,
                    99,
                    82,
                    82,
                    74,
                    66,
                    58,
                    41,
                    25,
                ],
                [
                    0,
                    0,
                    0,
                    189,
                    165,
                    148,
                    132,
                    107,
                    90,
                    197,
                    173,
                    156,
                    222,
                    206,
                    181,
                    173,
                    156,
                    132,
                    99,
                    82,
                    66,
                    156,
                    132,
                    115,
                    74,
                    58,
                    49,
                    189,
                    148,
                    115,
                    206,
                    181,
                    165,
                    197,
                    173,
                    148,
                    214,
                    189,
                    156,
                    189,
                    173,
                    148,
                    214,
                    181,
                    148,
                    197,
                    181,
                    165,
                ],
                [
                    0,
                    0,
                    0,
                    49,
                    41,
                    33,
                    66,
                    58,
                    49,
                    41,
                    33,
                    33,
                    58,
                    49,
                    41,
                    107,
                    90,
                    82,
                    132,
                    115,
                    107,
                    66,
                    49,
                    41,
                    90,
                    74,
                    66,
                    82,
                    66,
                    49,
                    74,
                    66,
                    58,
                    58,
                    58,
                    49,
                    74,
                    58,
                    41,
                    99,
                    74,
                    58,
                    82,
                    74,
                    66,
                    90,
                    82,
                    66,
                ],
                [
                    0,
                    0,
                    0,
                    99,
                    82,
                    74,
                    115,
                    99,
                    82,
                    189,
                    173,
                    148,
                    132,
                    115,
                    99,
                    82,
                    66,
                    58,
                    140,
                    123,
                    107,
                    58,
                    49,
                    41,
                    123,
                    107,
                    90,
                    123,
                    99,
                    74,
                    107,
                    82,
                    58,
                    90,
                    74,
                    66,
                    156,
                    140,
                    115,
                    99,
                    82,
                    66,
                    140,
                    107,
                    82,
                    214,
                    189,
                    173,
                ],
                [
                    0,
                    0,
                    0,
                    214,
                    189,
                    173,
                    90,
                    74,
                    66,
                    222,
                    197,
                    173,
                    197,
                    173,
                    148,
                    255,
                    230,
                    206,
                    189,
                    148,
                    115,
                    206,
                    165,
                    132,
                    173,
                    156,
                    140,
                    214,
                    189,
                    156,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    148,
                    132,
                    115,
                    214,
                    181,
                    148,
                    206,
                    181,
                    165,
                    214,
                    197,
                    181,
                ],
                [
                    0,
                    0,
                    0,
                    148,
                    115,
                    82,
                    115,
                    82,
                    58,
                    165,
                    123,
                    99,
                    140,
                    99,
                    74,
                    99,
                    74,
                    49,
                    123,
                    90,
                    66,
                    173,
                    140,
                    123,
                    115,
                    82,
                    66,
                    132,
                    107,
                    82,
                    132,
                    99,
                    66,
                    140,
                    115,
                    90,
                    82,
                    58,
                    41,
                    123,
                    99,
                    82,
                    132,
                    90,
                    66,
                    123,
                    107,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    36,
                    128,
                    166,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                ],
                [
                    0,
                    0,
                    0,
                    156,
                    132,
                    115,
                    132,
                    115,
                    99,
                    165,
                    140,
                    123,
                    82,
                    66,
                    58,
                    148,
                    115,
                    82,
                    214,
                    189,
                    173,
                    181,
                    140,
                    107,
                    165,
                    123,
                    90,
                    148,
                    123,
                    107,
                    140,
                    123,
                    115,
                    132,
                    107,
                    90,
                    123,
                    90,
                    74,
                    132,
                    115,
                    107,
                    189,
                    156,
                    123,
                    181,
                    165,
                    148,
                ],
                [
                    0,
                    0,
                    0,
                    197,
                    156,
                    123,
                    181,
                    140,
                    107,
                    214,
                    181,
                    148,
                    230,
                    206,
                    181,
                    173,
                    156,
                    132,
                    206,
                    165,
                    132,
                    197,
                    173,
                    148,
                    247,
                    222,
                    197,
                    148,
                    123,
                    107,
                    123,
                    99,
                    74,
                    181,
                    165,
                    140,
                    214,
                    189,
                    156,
                    222,
                    197,
                    181,
                    173,
                    148,
                    132,
                    181,
                    156,
                    140,
                ],
                [
                    0,
                    0,
                    0,
                    132,
                    107,
                    90,
                    140,
                    123,
                    107,
                    222,
                    197,
                    173,
                    148,
                    132,
                    115,
                    90,
                    74,
                    66,
                    140,
                    123,
                    99,
                    132,
                    115,
                    107,
                    132,
                    115,
                    99,
                    115,
                    99,
                    82,
                    123,
                    107,
                    99,
                    189,
                    148,
                    123,
                    140,
                    115,
                    90,
                    115,
                    99,
                    90,
                    173,
                    156,
                    140,
                    156,
                    123,
                    99,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    239,
                    214,
                    222,
                    206,
                    189,
                    247,
                    222,
                    197,
                    197,
                    173,
                    156,
                    214,
                    197,
                    181,
                    197,
                    181,
                    165,
                    206,
                    189,
                    173,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    255,
                    239,
                    214,
                    189,
                    165,
                    148,
                    222,
                    197,
                    173,
                    255,
                    239,
                    214,
                    255,
                    239,
                    214,
                    247,
                    222,
                    197,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    107,
                    123,
                    148,
                    255,
                    115,
                    123,
                    140,
                    255,
                    90,
                    107,
                    132,
                    255,
                    74,
                    90,
                    123,
                    255,
                    107,
                    115,
                    132,
                    255,
                    123,
                    156,
                    189,
                    255,
                    148,
                    165,
                    181,
                    255,
                    0,
                    0,
                    0,
                    0,
                    123,
                    156,
                    197,
                    255,
                    107,
                    140,
                    181,
                    255,
                    148,
                    181,
                    214,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    132,
                    156,
                    173,
                    255,
                    132,
                    165,
                    206,
                    255,
                    148,
                    173,
                    197,
                    255,
                    197,
                    222,
                    247,
                    255,
                    107,
                    123,
                    148,
                    255,
                    74,
                    99,
                    123,
                    255,
                    140,
                    165,
                    181,
                    255,
                    156,
                    189,
                    214,
                    255,
                    181,
                    197,
                    222,
                    255,
                    132,
                    148,
                    173,
                    255,
                    140,
                    156,
                    181,
                    255,
                ],
            ],
            self.one.apply_palette_animations(1),
        )
        self.assertEqual(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    165,
                    148,
                    132,
                    74,
                    66,
                    49,
                    189,
                    165,
                    148,
                    58,
                    49,
                    41,
                    115,
                    99,
                    82,
                    214,
                    189,
                    173,
                    132,
                    107,
                    74,
                    41,
                    33,
                    25,
                    148,
                    132,
                    115,
                    197,
                    156,
                    132,
                    132,
                    115,
                    99,
                    247,
                    230,
                    206,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    90,
                    74,
                    66,
                    107,
                    90,
                    74,
                    74,
                    58,
                    49,
                    99,
                    82,
                    74,
                    148,
                    132,
                    115,
                    123,
                    107,
                    90,
                    206,
                    181,
                    165,
                    107,
                    90,
                    82,
                    99,
                    74,
                    49,
                    82,
                    66,
                    58,
                    115,
                    82,
                    58,
                    58,
                    49,
                    33,
                    123,
                    90,
                    66,
                    132,
                    99,
                    74,
                    115,
                    99,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    173,
                    148,
                    132,
                    156,
                    132,
                    115,
                    189,
                    173,
                    156,
                    181,
                    140,
                    107,
                    99,
                    82,
                    66,
                    222,
                    197,
                    181,
                    66,
                    58,
                    49,
                    140,
                    99,
                    74,
                    181,
                    156,
                    140,
                    148,
                    132,
                    115,
                    165,
                    140,
                    123,
                    123,
                    107,
                    90,
                    148,
                    132,
                    123,
                    148,
                    115,
                    90,
                    165,
                    148,
                    132,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    49,
                    41,
                    99,
                    82,
                    74,
                    82,
                    58,
                    41,
                    74,
                    66,
                    58,
                    74,
                    49,
                    33,
                    66,
                    58,
                    49,
                    90,
                    66,
                    49,
                    49,
                    41,
                    33,
                    132,
                    115,
                    107,
                    107,
                    82,
                    58,
                    82,
                    66,
                    49,
                    99,
                    74,
                    58,
                    115,
                    99,
                    82,
                    82,
                    74,
                    66,
                    58,
                    41,
                    25,
                ],
                [
                    0,
                    0,
                    0,
                    189,
                    165,
                    148,
                    132,
                    107,
                    90,
                    197,
                    173,
                    156,
                    222,
                    206,
                    181,
                    173,
                    156,
                    132,
                    99,
                    82,
                    66,
                    156,
                    132,
                    115,
                    74,
                    58,
                    49,
                    189,
                    148,
                    115,
                    206,
                    181,
                    165,
                    197,
                    173,
                    148,
                    214,
                    189,
                    156,
                    189,
                    173,
                    148,
                    214,
                    181,
                    148,
                    197,
                    181,
                    165,
                ],
                [
                    0,
                    0,
                    0,
                    49,
                    41,
                    33,
                    66,
                    58,
                    49,
                    41,
                    33,
                    33,
                    58,
                    49,
                    41,
                    107,
                    90,
                    82,
                    132,
                    115,
                    107,
                    66,
                    49,
                    41,
                    90,
                    74,
                    66,
                    82,
                    66,
                    49,
                    74,
                    66,
                    58,
                    58,
                    58,
                    49,
                    74,
                    58,
                    41,
                    99,
                    74,
                    58,
                    82,
                    74,
                    66,
                    90,
                    82,
                    66,
                ],
                [
                    0,
                    0,
                    0,
                    99,
                    82,
                    74,
                    115,
                    99,
                    82,
                    189,
                    173,
                    148,
                    132,
                    115,
                    99,
                    82,
                    66,
                    58,
                    140,
                    123,
                    107,
                    58,
                    49,
                    41,
                    123,
                    107,
                    90,
                    123,
                    99,
                    74,
                    107,
                    82,
                    58,
                    90,
                    74,
                    66,
                    156,
                    140,
                    115,
                    99,
                    82,
                    66,
                    140,
                    107,
                    82,
                    214,
                    189,
                    173,
                ],
                [
                    0,
                    0,
                    0,
                    214,
                    189,
                    173,
                    90,
                    74,
                    66,
                    222,
                    197,
                    173,
                    197,
                    173,
                    148,
                    255,
                    230,
                    206,
                    189,
                    148,
                    115,
                    206,
                    165,
                    132,
                    173,
                    156,
                    140,
                    214,
                    189,
                    156,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    148,
                    132,
                    115,
                    214,
                    181,
                    148,
                    206,
                    181,
                    165,
                    214,
                    197,
                    181,
                ],
                [
                    0,
                    0,
                    0,
                    148,
                    115,
                    82,
                    115,
                    82,
                    58,
                    165,
                    123,
                    99,
                    140,
                    99,
                    74,
                    99,
                    74,
                    49,
                    123,
                    90,
                    66,
                    173,
                    140,
                    123,
                    115,
                    82,
                    66,
                    132,
                    107,
                    82,
                    132,
                    99,
                    66,
                    140,
                    115,
                    90,
                    82,
                    58,
                    41,
                    123,
                    99,
                    82,
                    132,
                    90,
                    66,
                    123,
                    107,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    33,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                ],
                [
                    0,
                    0,
                    0,
                    156,
                    132,
                    115,
                    132,
                    115,
                    99,
                    165,
                    140,
                    123,
                    82,
                    66,
                    58,
                    148,
                    115,
                    82,
                    214,
                    189,
                    173,
                    181,
                    140,
                    107,
                    165,
                    123,
                    90,
                    148,
                    123,
                    107,
                    140,
                    123,
                    115,
                    132,
                    107,
                    90,
                    123,
                    90,
                    74,
                    132,
                    115,
                    107,
                    189,
                    156,
                    123,
                    181,
                    165,
                    148,
                ],
                [
                    0,
                    0,
                    0,
                    197,
                    156,
                    123,
                    181,
                    140,
                    107,
                    214,
                    181,
                    148,
                    230,
                    206,
                    181,
                    173,
                    156,
                    132,
                    206,
                    165,
                    132,
                    197,
                    173,
                    148,
                    247,
                    222,
                    197,
                    148,
                    123,
                    107,
                    123,
                    99,
                    74,
                    181,
                    165,
                    140,
                    214,
                    189,
                    156,
                    222,
                    197,
                    181,
                    173,
                    148,
                    132,
                    181,
                    156,
                    140,
                ],
                [
                    0,
                    0,
                    0,
                    132,
                    107,
                    90,
                    140,
                    123,
                    107,
                    222,
                    197,
                    173,
                    148,
                    132,
                    115,
                    90,
                    74,
                    66,
                    140,
                    123,
                    99,
                    132,
                    115,
                    107,
                    132,
                    115,
                    99,
                    115,
                    99,
                    82,
                    123,
                    107,
                    99,
                    189,
                    148,
                    123,
                    140,
                    115,
                    90,
                    115,
                    99,
                    90,
                    173,
                    156,
                    140,
                    156,
                    123,
                    99,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    239,
                    214,
                    222,
                    206,
                    189,
                    247,
                    222,
                    197,
                    197,
                    173,
                    156,
                    214,
                    197,
                    181,
                    197,
                    181,
                    165,
                    206,
                    189,
                    173,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    255,
                    239,
                    214,
                    189,
                    165,
                    148,
                    222,
                    197,
                    173,
                    255,
                    239,
                    214,
                    255,
                    239,
                    214,
                    247,
                    222,
                    197,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    107,
                    123,
                    148,
                    255,
                    115,
                    123,
                    140,
                    255,
                    90,
                    107,
                    132,
                    255,
                    74,
                    90,
                    123,
                    255,
                    107,
                    115,
                    132,
                    255,
                    123,
                    156,
                    189,
                    255,
                    148,
                    165,
                    181,
                    255,
                    0,
                    0,
                    0,
                    0,
                    123,
                    156,
                    197,
                    255,
                    107,
                    140,
                    181,
                    255,
                    148,
                    181,
                    214,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    132,
                    156,
                    173,
                    255,
                    132,
                    165,
                    206,
                    255,
                    148,
                    173,
                    197,
                    255,
                    197,
                    222,
                    247,
                    255,
                    107,
                    123,
                    148,
                    255,
                    74,
                    99,
                    123,
                    255,
                    140,
                    165,
                    181,
                    255,
                    156,
                    189,
                    214,
                    255,
                    181,
                    197,
                    222,
                    255,
                    132,
                    148,
                    173,
                    255,
                    140,
                    156,
                    181,
                    255,
                ],
            ],
            self.one.apply_palette_animations(2),
        )
        self.assertEqual(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    165,
                    148,
                    132,
                    74,
                    66,
                    49,
                    189,
                    165,
                    148,
                    58,
                    49,
                    41,
                    115,
                    99,
                    82,
                    214,
                    189,
                    173,
                    132,
                    107,
                    74,
                    41,
                    33,
                    25,
                    148,
                    132,
                    115,
                    197,
                    156,
                    132,
                    132,
                    115,
                    99,
                    247,
                    230,
                    206,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    90,
                    74,
                    66,
                    107,
                    90,
                    74,
                    74,
                    58,
                    49,
                    99,
                    82,
                    74,
                    148,
                    132,
                    115,
                    123,
                    107,
                    90,
                    206,
                    181,
                    165,
                    107,
                    90,
                    82,
                    99,
                    74,
                    49,
                    82,
                    66,
                    58,
                    115,
                    82,
                    58,
                    58,
                    49,
                    33,
                    123,
                    90,
                    66,
                    132,
                    99,
                    74,
                    115,
                    99,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    173,
                    148,
                    132,
                    156,
                    132,
                    115,
                    189,
                    173,
                    156,
                    181,
                    140,
                    107,
                    99,
                    82,
                    66,
                    222,
                    197,
                    181,
                    66,
                    58,
                    49,
                    140,
                    99,
                    74,
                    181,
                    156,
                    140,
                    148,
                    132,
                    115,
                    165,
                    140,
                    123,
                    123,
                    107,
                    90,
                    148,
                    132,
                    123,
                    148,
                    115,
                    90,
                    165,
                    148,
                    132,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    49,
                    41,
                    99,
                    82,
                    74,
                    82,
                    58,
                    41,
                    74,
                    66,
                    58,
                    74,
                    49,
                    33,
                    66,
                    58,
                    49,
                    90,
                    66,
                    49,
                    49,
                    41,
                    33,
                    132,
                    115,
                    107,
                    107,
                    82,
                    58,
                    82,
                    66,
                    49,
                    99,
                    74,
                    58,
                    115,
                    99,
                    82,
                    82,
                    74,
                    66,
                    58,
                    41,
                    25,
                ],
                [
                    0,
                    0,
                    0,
                    189,
                    165,
                    148,
                    132,
                    107,
                    90,
                    197,
                    173,
                    156,
                    222,
                    206,
                    181,
                    173,
                    156,
                    132,
                    99,
                    82,
                    66,
                    156,
                    132,
                    115,
                    74,
                    58,
                    49,
                    189,
                    148,
                    115,
                    206,
                    181,
                    165,
                    197,
                    173,
                    148,
                    214,
                    189,
                    156,
                    189,
                    173,
                    148,
                    214,
                    181,
                    148,
                    197,
                    181,
                    165,
                ],
                [
                    0,
                    0,
                    0,
                    49,
                    41,
                    33,
                    66,
                    58,
                    49,
                    41,
                    33,
                    33,
                    58,
                    49,
                    41,
                    107,
                    90,
                    82,
                    132,
                    115,
                    107,
                    66,
                    49,
                    41,
                    90,
                    74,
                    66,
                    82,
                    66,
                    49,
                    74,
                    66,
                    58,
                    58,
                    58,
                    49,
                    74,
                    58,
                    41,
                    99,
                    74,
                    58,
                    82,
                    74,
                    66,
                    90,
                    82,
                    66,
                ],
                [
                    0,
                    0,
                    0,
                    99,
                    82,
                    74,
                    115,
                    99,
                    82,
                    189,
                    173,
                    148,
                    132,
                    115,
                    99,
                    82,
                    66,
                    58,
                    140,
                    123,
                    107,
                    58,
                    49,
                    41,
                    123,
                    107,
                    90,
                    123,
                    99,
                    74,
                    107,
                    82,
                    58,
                    90,
                    74,
                    66,
                    156,
                    140,
                    115,
                    99,
                    82,
                    66,
                    140,
                    107,
                    82,
                    214,
                    189,
                    173,
                ],
                [
                    0,
                    0,
                    0,
                    214,
                    189,
                    173,
                    90,
                    74,
                    66,
                    222,
                    197,
                    173,
                    197,
                    173,
                    148,
                    255,
                    230,
                    206,
                    189,
                    148,
                    115,
                    206,
                    165,
                    132,
                    173,
                    156,
                    140,
                    214,
                    189,
                    156,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    148,
                    132,
                    115,
                    214,
                    181,
                    148,
                    206,
                    181,
                    165,
                    214,
                    197,
                    181,
                ],
                [
                    0,
                    0,
                    0,
                    148,
                    115,
                    82,
                    115,
                    82,
                    58,
                    165,
                    123,
                    99,
                    140,
                    99,
                    74,
                    99,
                    74,
                    49,
                    123,
                    90,
                    66,
                    173,
                    140,
                    123,
                    115,
                    82,
                    66,
                    132,
                    107,
                    82,
                    132,
                    99,
                    66,
                    140,
                    115,
                    90,
                    82,
                    58,
                    41,
                    123,
                    99,
                    82,
                    132,
                    90,
                    66,
                    123,
                    107,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    19,
                    33,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                ],
                [
                    0,
                    0,
                    0,
                    156,
                    132,
                    115,
                    132,
                    115,
                    99,
                    165,
                    140,
                    123,
                    82,
                    66,
                    58,
                    148,
                    115,
                    82,
                    214,
                    189,
                    173,
                    181,
                    140,
                    107,
                    165,
                    123,
                    90,
                    148,
                    123,
                    107,
                    140,
                    123,
                    115,
                    132,
                    107,
                    90,
                    123,
                    90,
                    74,
                    132,
                    115,
                    107,
                    189,
                    156,
                    123,
                    181,
                    165,
                    148,
                ],
                [
                    0,
                    0,
                    0,
                    197,
                    156,
                    123,
                    181,
                    140,
                    107,
                    214,
                    181,
                    148,
                    230,
                    206,
                    181,
                    173,
                    156,
                    132,
                    206,
                    165,
                    132,
                    197,
                    173,
                    148,
                    247,
                    222,
                    197,
                    148,
                    123,
                    107,
                    123,
                    99,
                    74,
                    181,
                    165,
                    140,
                    214,
                    189,
                    156,
                    222,
                    197,
                    181,
                    173,
                    148,
                    132,
                    181,
                    156,
                    140,
                ],
                [
                    0,
                    0,
                    0,
                    132,
                    107,
                    90,
                    140,
                    123,
                    107,
                    222,
                    197,
                    173,
                    148,
                    132,
                    115,
                    90,
                    74,
                    66,
                    140,
                    123,
                    99,
                    132,
                    115,
                    107,
                    132,
                    115,
                    99,
                    115,
                    99,
                    82,
                    123,
                    107,
                    99,
                    189,
                    148,
                    123,
                    140,
                    115,
                    90,
                    115,
                    99,
                    90,
                    173,
                    156,
                    140,
                    156,
                    123,
                    99,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    239,
                    214,
                    222,
                    206,
                    189,
                    247,
                    222,
                    197,
                    197,
                    173,
                    156,
                    214,
                    197,
                    181,
                    197,
                    181,
                    165,
                    206,
                    189,
                    173,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    255,
                    239,
                    214,
                    189,
                    165,
                    148,
                    222,
                    197,
                    173,
                    255,
                    239,
                    214,
                    255,
                    239,
                    214,
                    247,
                    222,
                    197,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    107,
                    123,
                    148,
                    255,
                    115,
                    123,
                    140,
                    255,
                    90,
                    107,
                    132,
                    255,
                    74,
                    90,
                    123,
                    255,
                    107,
                    115,
                    132,
                    255,
                    123,
                    156,
                    189,
                    255,
                    148,
                    165,
                    181,
                    255,
                    0,
                    0,
                    0,
                    0,
                    123,
                    156,
                    197,
                    255,
                    107,
                    140,
                    181,
                    255,
                    148,
                    181,
                    214,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    132,
                    156,
                    173,
                    255,
                    132,
                    165,
                    206,
                    255,
                    148,
                    173,
                    197,
                    255,
                    197,
                    222,
                    247,
                    255,
                    107,
                    123,
                    148,
                    255,
                    74,
                    99,
                    123,
                    255,
                    140,
                    165,
                    181,
                    255,
                    156,
                    189,
                    214,
                    255,
                    181,
                    197,
                    222,
                    255,
                    132,
                    148,
                    173,
                    255,
                    140,
                    156,
                    181,
                    255,
                ],
            ],
            self.one.apply_palette_animations(3),
        )
        self.assertEqual(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    165,
                    148,
                    132,
                    74,
                    66,
                    49,
                    189,
                    165,
                    148,
                    58,
                    49,
                    41,
                    115,
                    99,
                    82,
                    214,
                    189,
                    173,
                    132,
                    107,
                    74,
                    41,
                    33,
                    25,
                    148,
                    132,
                    115,
                    197,
                    156,
                    132,
                    132,
                    115,
                    99,
                    247,
                    230,
                    206,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    90,
                    74,
                    66,
                    107,
                    90,
                    74,
                    74,
                    58,
                    49,
                    99,
                    82,
                    74,
                    148,
                    132,
                    115,
                    123,
                    107,
                    90,
                    206,
                    181,
                    165,
                    107,
                    90,
                    82,
                    99,
                    74,
                    49,
                    82,
                    66,
                    58,
                    115,
                    82,
                    58,
                    58,
                    49,
                    33,
                    123,
                    90,
                    66,
                    132,
                    99,
                    74,
                    115,
                    99,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    173,
                    148,
                    132,
                    156,
                    132,
                    115,
                    189,
                    173,
                    156,
                    181,
                    140,
                    107,
                    99,
                    82,
                    66,
                    222,
                    197,
                    181,
                    66,
                    58,
                    49,
                    140,
                    99,
                    74,
                    181,
                    156,
                    140,
                    148,
                    132,
                    115,
                    165,
                    140,
                    123,
                    123,
                    107,
                    90,
                    148,
                    132,
                    123,
                    148,
                    115,
                    90,
                    165,
                    148,
                    132,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    49,
                    41,
                    99,
                    82,
                    74,
                    82,
                    58,
                    41,
                    74,
                    66,
                    58,
                    74,
                    49,
                    33,
                    66,
                    58,
                    49,
                    90,
                    66,
                    49,
                    49,
                    41,
                    33,
                    132,
                    115,
                    107,
                    107,
                    82,
                    58,
                    82,
                    66,
                    49,
                    99,
                    74,
                    58,
                    115,
                    99,
                    82,
                    82,
                    74,
                    66,
                    58,
                    41,
                    25,
                ],
                [
                    0,
                    0,
                    0,
                    189,
                    165,
                    148,
                    132,
                    107,
                    90,
                    197,
                    173,
                    156,
                    222,
                    206,
                    181,
                    173,
                    156,
                    132,
                    99,
                    82,
                    66,
                    156,
                    132,
                    115,
                    74,
                    58,
                    49,
                    189,
                    148,
                    115,
                    206,
                    181,
                    165,
                    197,
                    173,
                    148,
                    214,
                    189,
                    156,
                    189,
                    173,
                    148,
                    214,
                    181,
                    148,
                    197,
                    181,
                    165,
                ],
                [
                    0,
                    0,
                    0,
                    49,
                    41,
                    33,
                    66,
                    58,
                    49,
                    41,
                    33,
                    33,
                    58,
                    49,
                    41,
                    107,
                    90,
                    82,
                    132,
                    115,
                    107,
                    66,
                    49,
                    41,
                    90,
                    74,
                    66,
                    82,
                    66,
                    49,
                    74,
                    66,
                    58,
                    58,
                    58,
                    49,
                    74,
                    58,
                    41,
                    99,
                    74,
                    58,
                    82,
                    74,
                    66,
                    90,
                    82,
                    66,
                ],
                [
                    0,
                    0,
                    0,
                    99,
                    82,
                    74,
                    115,
                    99,
                    82,
                    189,
                    173,
                    148,
                    132,
                    115,
                    99,
                    82,
                    66,
                    58,
                    140,
                    123,
                    107,
                    58,
                    49,
                    41,
                    123,
                    107,
                    90,
                    123,
                    99,
                    74,
                    107,
                    82,
                    58,
                    90,
                    74,
                    66,
                    156,
                    140,
                    115,
                    99,
                    82,
                    66,
                    140,
                    107,
                    82,
                    214,
                    189,
                    173,
                ],
                [
                    0,
                    0,
                    0,
                    214,
                    189,
                    173,
                    90,
                    74,
                    66,
                    222,
                    197,
                    173,
                    197,
                    173,
                    148,
                    255,
                    230,
                    206,
                    189,
                    148,
                    115,
                    206,
                    165,
                    132,
                    173,
                    156,
                    140,
                    214,
                    189,
                    156,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    148,
                    132,
                    115,
                    214,
                    181,
                    148,
                    206,
                    181,
                    165,
                    214,
                    197,
                    181,
                ],
                [
                    0,
                    0,
                    0,
                    148,
                    115,
                    82,
                    115,
                    82,
                    58,
                    165,
                    123,
                    99,
                    140,
                    99,
                    74,
                    99,
                    74,
                    49,
                    123,
                    90,
                    66,
                    173,
                    140,
                    123,
                    115,
                    82,
                    66,
                    132,
                    107,
                    82,
                    132,
                    99,
                    66,
                    140,
                    115,
                    90,
                    82,
                    58,
                    41,
                    123,
                    99,
                    82,
                    132,
                    90,
                    66,
                    123,
                    107,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    156,
                    132,
                    115,
                    132,
                    115,
                    99,
                    165,
                    140,
                    123,
                    82,
                    66,
                    58,
                    148,
                    115,
                    82,
                    214,
                    189,
                    173,
                    181,
                    140,
                    107,
                    165,
                    123,
                    90,
                    148,
                    123,
                    107,
                    140,
                    123,
                    115,
                    132,
                    107,
                    90,
                    123,
                    90,
                    74,
                    132,
                    115,
                    107,
                    189,
                    156,
                    123,
                    181,
                    165,
                    148,
                ],
                [
                    0,
                    0,
                    0,
                    197,
                    156,
                    123,
                    181,
                    140,
                    107,
                    214,
                    181,
                    148,
                    230,
                    206,
                    181,
                    173,
                    156,
                    132,
                    206,
                    165,
                    132,
                    197,
                    173,
                    148,
                    247,
                    222,
                    197,
                    148,
                    123,
                    107,
                    123,
                    99,
                    74,
                    181,
                    165,
                    140,
                    214,
                    189,
                    156,
                    222,
                    197,
                    181,
                    173,
                    148,
                    132,
                    181,
                    156,
                    140,
                ],
                [
                    0,
                    0,
                    0,
                    132,
                    107,
                    90,
                    140,
                    123,
                    107,
                    222,
                    197,
                    173,
                    148,
                    132,
                    115,
                    90,
                    74,
                    66,
                    140,
                    123,
                    99,
                    132,
                    115,
                    107,
                    132,
                    115,
                    99,
                    115,
                    99,
                    82,
                    123,
                    107,
                    99,
                    189,
                    148,
                    123,
                    140,
                    115,
                    90,
                    115,
                    99,
                    90,
                    173,
                    156,
                    140,
                    156,
                    123,
                    99,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    239,
                    214,
                    222,
                    206,
                    189,
                    247,
                    222,
                    197,
                    197,
                    173,
                    156,
                    214,
                    197,
                    181,
                    197,
                    181,
                    165,
                    206,
                    189,
                    173,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    255,
                    239,
                    214,
                    189,
                    165,
                    148,
                    222,
                    197,
                    173,
                    255,
                    239,
                    214,
                    255,
                    239,
                    214,
                    247,
                    222,
                    197,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    107,
                    123,
                    148,
                    255,
                    115,
                    123,
                    140,
                    255,
                    90,
                    107,
                    132,
                    255,
                    74,
                    90,
                    123,
                    255,
                    107,
                    115,
                    132,
                    255,
                    123,
                    156,
                    189,
                    255,
                    148,
                    165,
                    181,
                    255,
                    0,
                    0,
                    0,
                    0,
                    123,
                    156,
                    197,
                    255,
                    107,
                    140,
                    181,
                    255,
                    148,
                    181,
                    214,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    132,
                    156,
                    173,
                    255,
                    132,
                    165,
                    206,
                    255,
                    148,
                    173,
                    197,
                    255,
                    197,
                    222,
                    247,
                    255,
                    107,
                    123,
                    148,
                    255,
                    74,
                    99,
                    123,
                    255,
                    140,
                    165,
                    181,
                    255,
                    156,
                    189,
                    214,
                    255,
                    181,
                    197,
                    222,
                    255,
                    132,
                    148,
                    173,
                    255,
                    140,
                    156,
                    181,
                    255,
                ],
            ],
            self.one.apply_palette_animations(4),
        )
        self.assertEqual(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    165,
                    148,
                    132,
                    74,
                    66,
                    49,
                    189,
                    165,
                    148,
                    58,
                    49,
                    41,
                    115,
                    99,
                    82,
                    214,
                    189,
                    173,
                    132,
                    107,
                    74,
                    41,
                    33,
                    25,
                    148,
                    132,
                    115,
                    197,
                    156,
                    132,
                    132,
                    115,
                    99,
                    247,
                    230,
                    206,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    90,
                    74,
                    66,
                    107,
                    90,
                    74,
                    74,
                    58,
                    49,
                    99,
                    82,
                    74,
                    148,
                    132,
                    115,
                    123,
                    107,
                    90,
                    206,
                    181,
                    165,
                    107,
                    90,
                    82,
                    99,
                    74,
                    49,
                    82,
                    66,
                    58,
                    115,
                    82,
                    58,
                    58,
                    49,
                    33,
                    123,
                    90,
                    66,
                    132,
                    99,
                    74,
                    115,
                    99,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    173,
                    148,
                    132,
                    156,
                    132,
                    115,
                    189,
                    173,
                    156,
                    181,
                    140,
                    107,
                    99,
                    82,
                    66,
                    222,
                    197,
                    181,
                    66,
                    58,
                    49,
                    140,
                    99,
                    74,
                    181,
                    156,
                    140,
                    148,
                    132,
                    115,
                    165,
                    140,
                    123,
                    123,
                    107,
                    90,
                    148,
                    132,
                    123,
                    148,
                    115,
                    90,
                    165,
                    148,
                    132,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    49,
                    41,
                    99,
                    82,
                    74,
                    82,
                    58,
                    41,
                    74,
                    66,
                    58,
                    74,
                    49,
                    33,
                    66,
                    58,
                    49,
                    90,
                    66,
                    49,
                    49,
                    41,
                    33,
                    132,
                    115,
                    107,
                    107,
                    82,
                    58,
                    82,
                    66,
                    49,
                    99,
                    74,
                    58,
                    115,
                    99,
                    82,
                    82,
                    74,
                    66,
                    58,
                    41,
                    25,
                ],
                [
                    0,
                    0,
                    0,
                    189,
                    165,
                    148,
                    132,
                    107,
                    90,
                    197,
                    173,
                    156,
                    222,
                    206,
                    181,
                    173,
                    156,
                    132,
                    99,
                    82,
                    66,
                    156,
                    132,
                    115,
                    74,
                    58,
                    49,
                    189,
                    148,
                    115,
                    206,
                    181,
                    165,
                    197,
                    173,
                    148,
                    214,
                    189,
                    156,
                    189,
                    173,
                    148,
                    214,
                    181,
                    148,
                    197,
                    181,
                    165,
                ],
                [
                    0,
                    0,
                    0,
                    49,
                    41,
                    33,
                    66,
                    58,
                    49,
                    41,
                    33,
                    33,
                    58,
                    49,
                    41,
                    107,
                    90,
                    82,
                    132,
                    115,
                    107,
                    66,
                    49,
                    41,
                    90,
                    74,
                    66,
                    82,
                    66,
                    49,
                    74,
                    66,
                    58,
                    58,
                    58,
                    49,
                    74,
                    58,
                    41,
                    99,
                    74,
                    58,
                    82,
                    74,
                    66,
                    90,
                    82,
                    66,
                ],
                [
                    0,
                    0,
                    0,
                    99,
                    82,
                    74,
                    115,
                    99,
                    82,
                    189,
                    173,
                    148,
                    132,
                    115,
                    99,
                    82,
                    66,
                    58,
                    140,
                    123,
                    107,
                    58,
                    49,
                    41,
                    123,
                    107,
                    90,
                    123,
                    99,
                    74,
                    107,
                    82,
                    58,
                    90,
                    74,
                    66,
                    156,
                    140,
                    115,
                    99,
                    82,
                    66,
                    140,
                    107,
                    82,
                    214,
                    189,
                    173,
                ],
                [
                    0,
                    0,
                    0,
                    214,
                    189,
                    173,
                    90,
                    74,
                    66,
                    222,
                    197,
                    173,
                    197,
                    173,
                    148,
                    255,
                    230,
                    206,
                    189,
                    148,
                    115,
                    206,
                    165,
                    132,
                    173,
                    156,
                    140,
                    214,
                    189,
                    156,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    148,
                    132,
                    115,
                    214,
                    181,
                    148,
                    206,
                    181,
                    165,
                    214,
                    197,
                    181,
                ],
                [
                    0,
                    0,
                    0,
                    148,
                    115,
                    82,
                    115,
                    82,
                    58,
                    165,
                    123,
                    99,
                    140,
                    99,
                    74,
                    99,
                    74,
                    49,
                    123,
                    90,
                    66,
                    173,
                    140,
                    123,
                    115,
                    82,
                    66,
                    132,
                    107,
                    82,
                    132,
                    99,
                    66,
                    140,
                    115,
                    90,
                    82,
                    58,
                    41,
                    123,
                    99,
                    82,
                    132,
                    90,
                    66,
                    123,
                    107,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    36,
                    128,
                    166,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                    37,
                    129,
                    167,
                ],
                [
                    0,
                    0,
                    0,
                    156,
                    132,
                    115,
                    132,
                    115,
                    99,
                    165,
                    140,
                    123,
                    82,
                    66,
                    58,
                    148,
                    115,
                    82,
                    214,
                    189,
                    173,
                    181,
                    140,
                    107,
                    165,
                    123,
                    90,
                    148,
                    123,
                    107,
                    140,
                    123,
                    115,
                    132,
                    107,
                    90,
                    123,
                    90,
                    74,
                    132,
                    115,
                    107,
                    189,
                    156,
                    123,
                    181,
                    165,
                    148,
                ],
                [
                    0,
                    0,
                    0,
                    197,
                    156,
                    123,
                    181,
                    140,
                    107,
                    214,
                    181,
                    148,
                    230,
                    206,
                    181,
                    173,
                    156,
                    132,
                    206,
                    165,
                    132,
                    197,
                    173,
                    148,
                    247,
                    222,
                    197,
                    148,
                    123,
                    107,
                    123,
                    99,
                    74,
                    181,
                    165,
                    140,
                    214,
                    189,
                    156,
                    222,
                    197,
                    181,
                    173,
                    148,
                    132,
                    181,
                    156,
                    140,
                ],
                [
                    0,
                    0,
                    0,
                    132,
                    107,
                    90,
                    140,
                    123,
                    107,
                    222,
                    197,
                    173,
                    148,
                    132,
                    115,
                    90,
                    74,
                    66,
                    140,
                    123,
                    99,
                    132,
                    115,
                    107,
                    132,
                    115,
                    99,
                    115,
                    99,
                    82,
                    123,
                    107,
                    99,
                    189,
                    148,
                    123,
                    140,
                    115,
                    90,
                    115,
                    99,
                    90,
                    173,
                    156,
                    140,
                    156,
                    123,
                    99,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    239,
                    214,
                    222,
                    206,
                    189,
                    247,
                    222,
                    197,
                    197,
                    173,
                    156,
                    214,
                    197,
                    181,
                    197,
                    181,
                    165,
                    206,
                    189,
                    173,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    255,
                    239,
                    214,
                    189,
                    165,
                    148,
                    222,
                    197,
                    173,
                    255,
                    239,
                    214,
                    255,
                    239,
                    214,
                    247,
                    222,
                    197,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    107,
                    123,
                    148,
                    255,
                    115,
                    123,
                    140,
                    255,
                    90,
                    107,
                    132,
                    255,
                    74,
                    90,
                    123,
                    255,
                    107,
                    115,
                    132,
                    255,
                    123,
                    156,
                    189,
                    255,
                    148,
                    165,
                    181,
                    255,
                    0,
                    0,
                    0,
                    0,
                    123,
                    156,
                    197,
                    255,
                    107,
                    140,
                    181,
                    255,
                    148,
                    181,
                    214,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    132,
                    156,
                    173,
                    255,
                    132,
                    165,
                    206,
                    255,
                    148,
                    173,
                    197,
                    255,
                    197,
                    222,
                    247,
                    255,
                    107,
                    123,
                    148,
                    255,
                    74,
                    99,
                    123,
                    255,
                    140,
                    165,
                    181,
                    255,
                    156,
                    189,
                    214,
                    255,
                    181,
                    197,
                    222,
                    255,
                    132,
                    148,
                    173,
                    255,
                    140,
                    156,
                    181,
                    255,
                ],
            ],
            self.one.apply_palette_animations(5),
        )
        self.assertEqual(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    165,
                    148,
                    132,
                    74,
                    66,
                    49,
                    189,
                    165,
                    148,
                    58,
                    49,
                    41,
                    115,
                    99,
                    82,
                    214,
                    189,
                    173,
                    132,
                    107,
                    74,
                    41,
                    33,
                    25,
                    148,
                    132,
                    115,
                    197,
                    156,
                    132,
                    132,
                    115,
                    99,
                    247,
                    230,
                    206,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    90,
                    74,
                    66,
                    107,
                    90,
                    74,
                    74,
                    58,
                    49,
                    99,
                    82,
                    74,
                    148,
                    132,
                    115,
                    123,
                    107,
                    90,
                    206,
                    181,
                    165,
                    107,
                    90,
                    82,
                    99,
                    74,
                    49,
                    82,
                    66,
                    58,
                    115,
                    82,
                    58,
                    58,
                    49,
                    33,
                    123,
                    90,
                    66,
                    132,
                    99,
                    74,
                    115,
                    99,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    173,
                    148,
                    132,
                    156,
                    132,
                    115,
                    189,
                    173,
                    156,
                    181,
                    140,
                    107,
                    99,
                    82,
                    66,
                    222,
                    197,
                    181,
                    66,
                    58,
                    49,
                    140,
                    99,
                    74,
                    181,
                    156,
                    140,
                    148,
                    132,
                    115,
                    165,
                    140,
                    123,
                    123,
                    107,
                    90,
                    148,
                    132,
                    123,
                    148,
                    115,
                    90,
                    165,
                    148,
                    132,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    49,
                    41,
                    99,
                    82,
                    74,
                    82,
                    58,
                    41,
                    74,
                    66,
                    58,
                    74,
                    49,
                    33,
                    66,
                    58,
                    49,
                    90,
                    66,
                    49,
                    49,
                    41,
                    33,
                    132,
                    115,
                    107,
                    107,
                    82,
                    58,
                    82,
                    66,
                    49,
                    99,
                    74,
                    58,
                    115,
                    99,
                    82,
                    82,
                    74,
                    66,
                    58,
                    41,
                    25,
                ],
                [
                    0,
                    0,
                    0,
                    189,
                    165,
                    148,
                    132,
                    107,
                    90,
                    197,
                    173,
                    156,
                    222,
                    206,
                    181,
                    173,
                    156,
                    132,
                    99,
                    82,
                    66,
                    156,
                    132,
                    115,
                    74,
                    58,
                    49,
                    189,
                    148,
                    115,
                    206,
                    181,
                    165,
                    197,
                    173,
                    148,
                    214,
                    189,
                    156,
                    189,
                    173,
                    148,
                    214,
                    181,
                    148,
                    197,
                    181,
                    165,
                ],
                [
                    0,
                    0,
                    0,
                    49,
                    41,
                    33,
                    66,
                    58,
                    49,
                    41,
                    33,
                    33,
                    58,
                    49,
                    41,
                    107,
                    90,
                    82,
                    132,
                    115,
                    107,
                    66,
                    49,
                    41,
                    90,
                    74,
                    66,
                    82,
                    66,
                    49,
                    74,
                    66,
                    58,
                    58,
                    58,
                    49,
                    74,
                    58,
                    41,
                    99,
                    74,
                    58,
                    82,
                    74,
                    66,
                    90,
                    82,
                    66,
                ],
                [
                    0,
                    0,
                    0,
                    99,
                    82,
                    74,
                    115,
                    99,
                    82,
                    189,
                    173,
                    148,
                    132,
                    115,
                    99,
                    82,
                    66,
                    58,
                    140,
                    123,
                    107,
                    58,
                    49,
                    41,
                    123,
                    107,
                    90,
                    123,
                    99,
                    74,
                    107,
                    82,
                    58,
                    90,
                    74,
                    66,
                    156,
                    140,
                    115,
                    99,
                    82,
                    66,
                    140,
                    107,
                    82,
                    214,
                    189,
                    173,
                ],
                [
                    0,
                    0,
                    0,
                    214,
                    189,
                    173,
                    90,
                    74,
                    66,
                    222,
                    197,
                    173,
                    197,
                    173,
                    148,
                    255,
                    230,
                    206,
                    189,
                    148,
                    115,
                    206,
                    165,
                    132,
                    173,
                    156,
                    140,
                    214,
                    189,
                    156,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    148,
                    132,
                    115,
                    214,
                    181,
                    148,
                    206,
                    181,
                    165,
                    214,
                    197,
                    181,
                ],
                [
                    0,
                    0,
                    0,
                    148,
                    115,
                    82,
                    115,
                    82,
                    58,
                    165,
                    123,
                    99,
                    140,
                    99,
                    74,
                    99,
                    74,
                    49,
                    123,
                    90,
                    66,
                    173,
                    140,
                    123,
                    115,
                    82,
                    66,
                    132,
                    107,
                    82,
                    132,
                    99,
                    66,
                    140,
                    115,
                    90,
                    82,
                    58,
                    41,
                    123,
                    99,
                    82,
                    132,
                    90,
                    66,
                    123,
                    107,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    33,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                    34,
                    81,
                    101,
                ],
                [
                    0,
                    0,
                    0,
                    156,
                    132,
                    115,
                    132,
                    115,
                    99,
                    165,
                    140,
                    123,
                    82,
                    66,
                    58,
                    148,
                    115,
                    82,
                    214,
                    189,
                    173,
                    181,
                    140,
                    107,
                    165,
                    123,
                    90,
                    148,
                    123,
                    107,
                    140,
                    123,
                    115,
                    132,
                    107,
                    90,
                    123,
                    90,
                    74,
                    132,
                    115,
                    107,
                    189,
                    156,
                    123,
                    181,
                    165,
                    148,
                ],
                [
                    0,
                    0,
                    0,
                    197,
                    156,
                    123,
                    181,
                    140,
                    107,
                    214,
                    181,
                    148,
                    230,
                    206,
                    181,
                    173,
                    156,
                    132,
                    206,
                    165,
                    132,
                    197,
                    173,
                    148,
                    247,
                    222,
                    197,
                    148,
                    123,
                    107,
                    123,
                    99,
                    74,
                    181,
                    165,
                    140,
                    214,
                    189,
                    156,
                    222,
                    197,
                    181,
                    173,
                    148,
                    132,
                    181,
                    156,
                    140,
                ],
                [
                    0,
                    0,
                    0,
                    132,
                    107,
                    90,
                    140,
                    123,
                    107,
                    222,
                    197,
                    173,
                    148,
                    132,
                    115,
                    90,
                    74,
                    66,
                    140,
                    123,
                    99,
                    132,
                    115,
                    107,
                    132,
                    115,
                    99,
                    115,
                    99,
                    82,
                    123,
                    107,
                    99,
                    189,
                    148,
                    123,
                    140,
                    115,
                    90,
                    115,
                    99,
                    90,
                    173,
                    156,
                    140,
                    156,
                    123,
                    99,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    239,
                    214,
                    222,
                    206,
                    189,
                    247,
                    222,
                    197,
                    197,
                    173,
                    156,
                    214,
                    197,
                    181,
                    197,
                    181,
                    165,
                    206,
                    189,
                    173,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    255,
                    239,
                    214,
                    189,
                    165,
                    148,
                    222,
                    197,
                    173,
                    255,
                    239,
                    214,
                    255,
                    239,
                    214,
                    247,
                    222,
                    197,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    107,
                    123,
                    148,
                    255,
                    115,
                    123,
                    140,
                    255,
                    90,
                    107,
                    132,
                    255,
                    74,
                    90,
                    123,
                    255,
                    107,
                    115,
                    132,
                    255,
                    123,
                    156,
                    189,
                    255,
                    148,
                    165,
                    181,
                    255,
                    0,
                    0,
                    0,
                    0,
                    123,
                    156,
                    197,
                    255,
                    107,
                    140,
                    181,
                    255,
                    148,
                    181,
                    214,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    132,
                    156,
                    173,
                    255,
                    132,
                    165,
                    206,
                    255,
                    148,
                    173,
                    197,
                    255,
                    197,
                    222,
                    247,
                    255,
                    107,
                    123,
                    148,
                    255,
                    74,
                    99,
                    123,
                    255,
                    140,
                    165,
                    181,
                    255,
                    156,
                    189,
                    214,
                    255,
                    181,
                    197,
                    222,
                    255,
                    132,
                    148,
                    173,
                    255,
                    140,
                    156,
                    181,
                    255,
                ],
            ],
            self.one.apply_palette_animations(6),
        )
        self.assertEqual(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    165,
                    148,
                    132,
                    74,
                    66,
                    49,
                    189,
                    165,
                    148,
                    58,
                    49,
                    41,
                    115,
                    99,
                    82,
                    214,
                    189,
                    173,
                    132,
                    107,
                    74,
                    41,
                    33,
                    25,
                    148,
                    132,
                    115,
                    197,
                    156,
                    132,
                    132,
                    115,
                    99,
                    247,
                    230,
                    206,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    90,
                    74,
                    66,
                    107,
                    90,
                    74,
                    74,
                    58,
                    49,
                    99,
                    82,
                    74,
                    148,
                    132,
                    115,
                    123,
                    107,
                    90,
                    206,
                    181,
                    165,
                    107,
                    90,
                    82,
                    99,
                    74,
                    49,
                    82,
                    66,
                    58,
                    115,
                    82,
                    58,
                    58,
                    49,
                    33,
                    123,
                    90,
                    66,
                    132,
                    99,
                    74,
                    115,
                    99,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    173,
                    148,
                    132,
                    156,
                    132,
                    115,
                    189,
                    173,
                    156,
                    181,
                    140,
                    107,
                    99,
                    82,
                    66,
                    222,
                    197,
                    181,
                    66,
                    58,
                    49,
                    140,
                    99,
                    74,
                    181,
                    156,
                    140,
                    148,
                    132,
                    115,
                    165,
                    140,
                    123,
                    123,
                    107,
                    90,
                    148,
                    132,
                    123,
                    148,
                    115,
                    90,
                    165,
                    148,
                    132,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    49,
                    41,
                    99,
                    82,
                    74,
                    82,
                    58,
                    41,
                    74,
                    66,
                    58,
                    74,
                    49,
                    33,
                    66,
                    58,
                    49,
                    90,
                    66,
                    49,
                    49,
                    41,
                    33,
                    132,
                    115,
                    107,
                    107,
                    82,
                    58,
                    82,
                    66,
                    49,
                    99,
                    74,
                    58,
                    115,
                    99,
                    82,
                    82,
                    74,
                    66,
                    58,
                    41,
                    25,
                ],
                [
                    0,
                    0,
                    0,
                    189,
                    165,
                    148,
                    132,
                    107,
                    90,
                    197,
                    173,
                    156,
                    222,
                    206,
                    181,
                    173,
                    156,
                    132,
                    99,
                    82,
                    66,
                    156,
                    132,
                    115,
                    74,
                    58,
                    49,
                    189,
                    148,
                    115,
                    206,
                    181,
                    165,
                    197,
                    173,
                    148,
                    214,
                    189,
                    156,
                    189,
                    173,
                    148,
                    214,
                    181,
                    148,
                    197,
                    181,
                    165,
                ],
                [
                    0,
                    0,
                    0,
                    49,
                    41,
                    33,
                    66,
                    58,
                    49,
                    41,
                    33,
                    33,
                    58,
                    49,
                    41,
                    107,
                    90,
                    82,
                    132,
                    115,
                    107,
                    66,
                    49,
                    41,
                    90,
                    74,
                    66,
                    82,
                    66,
                    49,
                    74,
                    66,
                    58,
                    58,
                    58,
                    49,
                    74,
                    58,
                    41,
                    99,
                    74,
                    58,
                    82,
                    74,
                    66,
                    90,
                    82,
                    66,
                ],
                [
                    0,
                    0,
                    0,
                    99,
                    82,
                    74,
                    115,
                    99,
                    82,
                    189,
                    173,
                    148,
                    132,
                    115,
                    99,
                    82,
                    66,
                    58,
                    140,
                    123,
                    107,
                    58,
                    49,
                    41,
                    123,
                    107,
                    90,
                    123,
                    99,
                    74,
                    107,
                    82,
                    58,
                    90,
                    74,
                    66,
                    156,
                    140,
                    115,
                    99,
                    82,
                    66,
                    140,
                    107,
                    82,
                    214,
                    189,
                    173,
                ],
                [
                    0,
                    0,
                    0,
                    214,
                    189,
                    173,
                    90,
                    74,
                    66,
                    222,
                    197,
                    173,
                    197,
                    173,
                    148,
                    255,
                    230,
                    206,
                    189,
                    148,
                    115,
                    206,
                    165,
                    132,
                    173,
                    156,
                    140,
                    214,
                    189,
                    156,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    148,
                    132,
                    115,
                    214,
                    181,
                    148,
                    206,
                    181,
                    165,
                    214,
                    197,
                    181,
                ],
                [
                    0,
                    0,
                    0,
                    148,
                    115,
                    82,
                    115,
                    82,
                    58,
                    165,
                    123,
                    99,
                    140,
                    99,
                    74,
                    99,
                    74,
                    49,
                    123,
                    90,
                    66,
                    173,
                    140,
                    123,
                    115,
                    82,
                    66,
                    132,
                    107,
                    82,
                    132,
                    99,
                    66,
                    140,
                    115,
                    90,
                    82,
                    58,
                    41,
                    123,
                    99,
                    82,
                    132,
                    90,
                    66,
                    123,
                    107,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    19,
                    33,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                    20,
                    32,
                    39,
                ],
                [
                    0,
                    0,
                    0,
                    156,
                    132,
                    115,
                    132,
                    115,
                    99,
                    165,
                    140,
                    123,
                    82,
                    66,
                    58,
                    148,
                    115,
                    82,
                    214,
                    189,
                    173,
                    181,
                    140,
                    107,
                    165,
                    123,
                    90,
                    148,
                    123,
                    107,
                    140,
                    123,
                    115,
                    132,
                    107,
                    90,
                    123,
                    90,
                    74,
                    132,
                    115,
                    107,
                    189,
                    156,
                    123,
                    181,
                    165,
                    148,
                ],
                [
                    0,
                    0,
                    0,
                    197,
                    156,
                    123,
                    181,
                    140,
                    107,
                    214,
                    181,
                    148,
                    230,
                    206,
                    181,
                    173,
                    156,
                    132,
                    206,
                    165,
                    132,
                    197,
                    173,
                    148,
                    247,
                    222,
                    197,
                    148,
                    123,
                    107,
                    123,
                    99,
                    74,
                    181,
                    165,
                    140,
                    214,
                    189,
                    156,
                    222,
                    197,
                    181,
                    173,
                    148,
                    132,
                    181,
                    156,
                    140,
                ],
                [
                    0,
                    0,
                    0,
                    132,
                    107,
                    90,
                    140,
                    123,
                    107,
                    222,
                    197,
                    173,
                    148,
                    132,
                    115,
                    90,
                    74,
                    66,
                    140,
                    123,
                    99,
                    132,
                    115,
                    107,
                    132,
                    115,
                    99,
                    115,
                    99,
                    82,
                    123,
                    107,
                    99,
                    189,
                    148,
                    123,
                    140,
                    115,
                    90,
                    115,
                    99,
                    90,
                    173,
                    156,
                    140,
                    156,
                    123,
                    99,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    239,
                    214,
                    222,
                    206,
                    189,
                    247,
                    222,
                    197,
                    197,
                    173,
                    156,
                    214,
                    197,
                    181,
                    197,
                    181,
                    165,
                    206,
                    189,
                    173,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    255,
                    239,
                    214,
                    189,
                    165,
                    148,
                    222,
                    197,
                    173,
                    255,
                    239,
                    214,
                    255,
                    239,
                    214,
                    247,
                    222,
                    197,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    107,
                    123,
                    148,
                    255,
                    115,
                    123,
                    140,
                    255,
                    90,
                    107,
                    132,
                    255,
                    74,
                    90,
                    123,
                    255,
                    107,
                    115,
                    132,
                    255,
                    123,
                    156,
                    189,
                    255,
                    148,
                    165,
                    181,
                    255,
                    0,
                    0,
                    0,
                    0,
                    123,
                    156,
                    197,
                    255,
                    107,
                    140,
                    181,
                    255,
                    148,
                    181,
                    214,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    132,
                    156,
                    173,
                    255,
                    132,
                    165,
                    206,
                    255,
                    148,
                    173,
                    197,
                    255,
                    197,
                    222,
                    247,
                    255,
                    107,
                    123,
                    148,
                    255,
                    74,
                    99,
                    123,
                    255,
                    140,
                    165,
                    181,
                    255,
                    156,
                    189,
                    214,
                    255,
                    181,
                    197,
                    222,
                    255,
                    132,
                    148,
                    173,
                    255,
                    140,
                    156,
                    181,
                    255,
                ],
            ],
            self.one.apply_palette_animations(7),
        )
        self.assertEqual(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    165,
                    148,
                    132,
                    74,
                    66,
                    49,
                    189,
                    165,
                    148,
                    58,
                    49,
                    41,
                    115,
                    99,
                    82,
                    214,
                    189,
                    173,
                    132,
                    107,
                    74,
                    41,
                    33,
                    25,
                    148,
                    132,
                    115,
                    197,
                    156,
                    132,
                    132,
                    115,
                    99,
                    247,
                    230,
                    206,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    90,
                    74,
                    66,
                    107,
                    90,
                    74,
                    74,
                    58,
                    49,
                    99,
                    82,
                    74,
                    148,
                    132,
                    115,
                    123,
                    107,
                    90,
                    206,
                    181,
                    165,
                    107,
                    90,
                    82,
                    99,
                    74,
                    49,
                    82,
                    66,
                    58,
                    115,
                    82,
                    58,
                    58,
                    49,
                    33,
                    123,
                    90,
                    66,
                    132,
                    99,
                    74,
                    115,
                    99,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    173,
                    148,
                    132,
                    156,
                    132,
                    115,
                    189,
                    173,
                    156,
                    181,
                    140,
                    107,
                    99,
                    82,
                    66,
                    222,
                    197,
                    181,
                    66,
                    58,
                    49,
                    140,
                    99,
                    74,
                    181,
                    156,
                    140,
                    148,
                    132,
                    115,
                    165,
                    140,
                    123,
                    123,
                    107,
                    90,
                    148,
                    132,
                    123,
                    148,
                    115,
                    90,
                    165,
                    148,
                    132,
                ],
                [
                    0,
                    0,
                    0,
                    66,
                    49,
                    41,
                    99,
                    82,
                    74,
                    82,
                    58,
                    41,
                    74,
                    66,
                    58,
                    74,
                    49,
                    33,
                    66,
                    58,
                    49,
                    90,
                    66,
                    49,
                    49,
                    41,
                    33,
                    132,
                    115,
                    107,
                    107,
                    82,
                    58,
                    82,
                    66,
                    49,
                    99,
                    74,
                    58,
                    115,
                    99,
                    82,
                    82,
                    74,
                    66,
                    58,
                    41,
                    25,
                ],
                [
                    0,
                    0,
                    0,
                    189,
                    165,
                    148,
                    132,
                    107,
                    90,
                    197,
                    173,
                    156,
                    222,
                    206,
                    181,
                    173,
                    156,
                    132,
                    99,
                    82,
                    66,
                    156,
                    132,
                    115,
                    74,
                    58,
                    49,
                    189,
                    148,
                    115,
                    206,
                    181,
                    165,
                    197,
                    173,
                    148,
                    214,
                    189,
                    156,
                    189,
                    173,
                    148,
                    214,
                    181,
                    148,
                    197,
                    181,
                    165,
                ],
                [
                    0,
                    0,
                    0,
                    49,
                    41,
                    33,
                    66,
                    58,
                    49,
                    41,
                    33,
                    33,
                    58,
                    49,
                    41,
                    107,
                    90,
                    82,
                    132,
                    115,
                    107,
                    66,
                    49,
                    41,
                    90,
                    74,
                    66,
                    82,
                    66,
                    49,
                    74,
                    66,
                    58,
                    58,
                    58,
                    49,
                    74,
                    58,
                    41,
                    99,
                    74,
                    58,
                    82,
                    74,
                    66,
                    90,
                    82,
                    66,
                ],
                [
                    0,
                    0,
                    0,
                    99,
                    82,
                    74,
                    115,
                    99,
                    82,
                    189,
                    173,
                    148,
                    132,
                    115,
                    99,
                    82,
                    66,
                    58,
                    140,
                    123,
                    107,
                    58,
                    49,
                    41,
                    123,
                    107,
                    90,
                    123,
                    99,
                    74,
                    107,
                    82,
                    58,
                    90,
                    74,
                    66,
                    156,
                    140,
                    115,
                    99,
                    82,
                    66,
                    140,
                    107,
                    82,
                    214,
                    189,
                    173,
                ],
                [
                    0,
                    0,
                    0,
                    214,
                    189,
                    173,
                    90,
                    74,
                    66,
                    222,
                    197,
                    173,
                    197,
                    173,
                    148,
                    255,
                    230,
                    206,
                    189,
                    148,
                    115,
                    206,
                    165,
                    132,
                    173,
                    156,
                    140,
                    214,
                    189,
                    156,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    148,
                    132,
                    115,
                    214,
                    181,
                    148,
                    206,
                    181,
                    165,
                    214,
                    197,
                    181,
                ],
                [
                    0,
                    0,
                    0,
                    148,
                    115,
                    82,
                    115,
                    82,
                    58,
                    165,
                    123,
                    99,
                    140,
                    99,
                    74,
                    99,
                    74,
                    49,
                    123,
                    90,
                    66,
                    173,
                    140,
                    123,
                    115,
                    82,
                    66,
                    132,
                    107,
                    82,
                    132,
                    99,
                    66,
                    140,
                    115,
                    90,
                    82,
                    58,
                    41,
                    123,
                    99,
                    82,
                    132,
                    90,
                    66,
                    123,
                    107,
                    90,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                    0,
                    181,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    156,
                    132,
                    115,
                    132,
                    115,
                    99,
                    165,
                    140,
                    123,
                    82,
                    66,
                    58,
                    148,
                    115,
                    82,
                    214,
                    189,
                    173,
                    181,
                    140,
                    107,
                    165,
                    123,
                    90,
                    148,
                    123,
                    107,
                    140,
                    123,
                    115,
                    132,
                    107,
                    90,
                    123,
                    90,
                    74,
                    132,
                    115,
                    107,
                    189,
                    156,
                    123,
                    181,
                    165,
                    148,
                ],
                [
                    0,
                    0,
                    0,
                    197,
                    156,
                    123,
                    181,
                    140,
                    107,
                    214,
                    181,
                    148,
                    230,
                    206,
                    181,
                    173,
                    156,
                    132,
                    206,
                    165,
                    132,
                    197,
                    173,
                    148,
                    247,
                    222,
                    197,
                    148,
                    123,
                    107,
                    123,
                    99,
                    74,
                    181,
                    165,
                    140,
                    214,
                    189,
                    156,
                    222,
                    197,
                    181,
                    173,
                    148,
                    132,
                    181,
                    156,
                    140,
                ],
                [
                    0,
                    0,
                    0,
                    132,
                    107,
                    90,
                    140,
                    123,
                    107,
                    222,
                    197,
                    173,
                    148,
                    132,
                    115,
                    90,
                    74,
                    66,
                    140,
                    123,
                    99,
                    132,
                    115,
                    107,
                    132,
                    115,
                    99,
                    115,
                    99,
                    82,
                    123,
                    107,
                    99,
                    189,
                    148,
                    123,
                    140,
                    115,
                    90,
                    115,
                    99,
                    90,
                    173,
                    156,
                    140,
                    156,
                    123,
                    99,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    239,
                    214,
                    222,
                    206,
                    189,
                    247,
                    222,
                    197,
                    197,
                    173,
                    156,
                    214,
                    197,
                    181,
                    197,
                    181,
                    165,
                    206,
                    189,
                    173,
                    230,
                    206,
                    181,
                    222,
                    197,
                    181,
                    255,
                    239,
                    214,
                    189,
                    165,
                    148,
                    222,
                    197,
                    173,
                    255,
                    239,
                    214,
                    255,
                    239,
                    214,
                    247,
                    222,
                    197,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    107,
                    123,
                    148,
                    255,
                    115,
                    123,
                    140,
                    255,
                    90,
                    107,
                    132,
                    255,
                    74,
                    90,
                    123,
                    255,
                    107,
                    115,
                    132,
                    255,
                    123,
                    156,
                    189,
                    255,
                    148,
                    165,
                    181,
                    255,
                    0,
                    0,
                    0,
                    0,
                    123,
                    156,
                    197,
                    255,
                    107,
                    140,
                    181,
                    255,
                    148,
                    181,
                    214,
                    255,
                ],
                [
                    0,
                    0,
                    0,
                    255,
                    132,
                    156,
                    173,
                    255,
                    132,
                    165,
                    206,
                    255,
                    148,
                    173,
                    197,
                    255,
                    197,
                    222,
                    247,
                    255,
                    107,
                    123,
                    148,
                    255,
                    74,
                    99,
                    123,
                    255,
                    140,
                    165,
                    181,
                    255,
                    156,
                    189,
                    214,
                    255,
                    181,
                    197,
                    222,
                    255,
                    132,
                    148,
                    173,
                    255,
                    140,
                    156,
                    181,
                    255,
                ],
            ],
            self.one.apply_palette_animations(8),
        )

    def test_is_palette_affected_by_animation(self) -> None:
        for i in range(16):
            self.assertFalse(self.two.is_palette_affected_by_animation(i))
        for i in range(16):
            if i == 9:
                self.assertTrue(self.one.is_palette_affected_by_animation(i))
            else:
                self.assertFalse(self.one.is_palette_affected_by_animation(i))

    def test_get_real_palettes(self) -> None:
        new_pal = [
            [0] * 16 * 3,
            [0, 0, 0] + [1] * 15 * 3,
            [0, 0, 0] + [2] * 15 * 3,
            [0, 0, 0] + [3] * 15 * 3,
        ]
        self.one.set_palettes(new_pal * 4)
        self.assertEqual(new_pal * 4, self.one.get_real_palettes())
        self.one.set_palettes(list(new_pal))
        self.assertEqual(new_pal, self.one.get_real_palettes())

    def test_set_palettes(self) -> None:
        new_pal = [
            [0] * 16 * 3,
            [0, 0, 0] + [1] * 15 * 3,
            [0, 0, 0] + [2] * 15 * 3,
            [0, 0, 0] + [3] * 15 * 3,
        ]
        greyscale = [(i // 3) * 16 for i in range(16 * 3)]
        self.one.set_palettes(new_pal * 4)

        self.assertEqual(16, self.one.number_palettes)
        self.assertEqual(new_pal * 4, self.one.palettes)
        self.assertEqual(16, len(self.one.animation_specs))
        saved = self._save_and_reload_main_fixture(self.one)
        self.assertEqual(16, saved.number_palettes)
        self.assertEqual(new_pal * 4, saved.palettes)
        self.assertEqual(16, len(saved.animation_specs))

        self.one.set_palettes(list(new_pal))

        self.assertEqual(4, self.one.number_palettes)
        self.assertEqual(new_pal + [greyscale] * 12, self.one.palettes)
        self.assertEqual(16, len(self.one.animation_specs))
        saved = self._save_and_reload_main_fixture(self.one)
        self.assertEqual(4, saved.number_palettes)
        self.assertEqual(new_pal + [greyscale] * 12, saved.palettes)
        self.assertEqual(4, len(saved.animation_specs))

    @romtest(file_ext="bpl", path="MAP_BG/")
    def test_using_rom(self, _, file):
        bpl_before = self.handler.deserialize(file)
        bpl_after = self._save_and_reload_main_fixture(bpl_before)

        self.assertEqual(bpl_before.number_palettes, bpl_after.number_palettes)
        self.assertEqual(bpl_before.has_palette_animation, bpl_after.has_palette_animation)
        self.assertEqual(bpl_before.palettes, bpl_after.palettes)
        self.assertEqual(bpl_before.animation_palette, bpl_after.animation_palette)
        self.assertEqual(len(bpl_before.animation_specs), len(bpl_after.animation_specs))
        for spec_before, spec_after in zip(bpl_before.animation_specs, bpl_after.animation_specs):
            self.assertEqual(spec_before.duration_per_frame, spec_after.duration_per_frame)
            self.assertEqual(spec_before.number_of_frames, spec_after.number_of_frames)

    @typing.no_type_check
    @classmethod
    @fixpath
    def _fix_path1(cls):
        return "..", "fixtures", "MAP_BG", "coco.bpl"

    @typing.no_type_check
    @classmethod
    @fixpath
    def _fix_path2(cls):
        return "fixtures", "two.bpl"
